<p>An http server, with write only permission for backup solution.</p>
<p>The idea is to allow clients to push backup files to centralized server over LAN, unlike other backup solution file-bucket doesn't use the classic username/password pair to auth the user but a single 32-byte long token.</p>
<p>To enhanced security each server can <strong>only</strong> write into it's own bucket, so if a server is compromised the attacker can only guess the server token but it cannot read old backups neither discover or read other server backup files.</p>
<div class="section" id="installation">
<h1>Installation</h1>
<p>To install the file-bucket on debian system you can dowload the package from <a class="reference external" href="http://claudyus.github.io/file-bucket/">http://claudyus.github.io/file-bucket/</a> install it with <tt class="docutils literal">dpkg</tt>:</p>
<pre class="literal-block">
$ wget http://claudyus.github.io/file-bucket/file-bucket_VERSION.deb
$ dpkg -i file-bucket_VERSION.deb
</pre>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>You should configure the buckets list and buckets home inside <tt class="docutils literal"><span class="pre">/etc/file-bucket/config.json</span></tt>
To override this settings you can pass <tt class="docutils literal"><span class="pre">--config</span> &lt;file&gt;</tt> as command line parameters.</p>
<p>The bucket list can also be reload using <tt class="docutils literal">SIGUSR2</tt>, please note that only changes to bucket list are effective using this method.</p>
</div>
<div class="section" id="use">
<h2>Use</h2>
<p>On your client you can simple push backup file using curl like:</p>
<pre class="literal-block">
$ curl -X POST &lt;serverip&gt;:1234/&lt;bucket_token&gt; -F file=&#64;&lt;file&gt;
</pre>
<p>The server will responde with <tt class="docutils literal">200</tt> on success or with the following errorcode are used:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">ErrorCode</th>
<th class="head">Detail</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>403</td>
<td>given token doesn't exist</td>
</tr>
<tr><td>412</td>
<td>missed file in form post</td>
</tr>
<tr><td>405</td>
<td>file yet exist on filesystem</td>
</tr>
<tr><td>401</td>
<td>cannot create bucket dirs</td>
</tr>
<tr><td>409</td>
<td>abort due to pre-push script (see below)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="extending-the-behaviour">
<h1>Extending the behaviour</h1>
<p><tt class="docutils literal"><span class="pre">file-bucket</span></tt> support a series of hooks that can be used to extend the default behaviour.
For example you can email someone when a file is pushed or deploy the file as a lxc container or the contained files in an automatic way.</p>
<p>At the moment the following hooks are defined:</p>
<ul class="simple">
<li>pre-push.sh</li>
<li>post-push.sh</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">/etc/file-bucket/pre-push.sh</span></tt> script is executed before the check of the file presence on the filesystem is executed.
This script should return <strong>0</strong> to allow the file upload, should return <strong>1</strong> to abort the upload and could return <strong>2</strong> to allow file overwrite.
This script is called with the arguments:</p>
<ul class="simple">
<li>bucket token</li>
<li>upload filename</li>
<li>file size (TODO)</li>
<li>remote ip_client:port</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">/etc/file-bucket/post-push.sh</span></tt> script is executed after the file upload and can be used to manipulate the file itself.
This script is called with the arguments:</p>
<ul class="simple">
<li>bucket token</li>
<li>complete filename with path</li>
<li>remote ip_client:port</li>
</ul>
<p>The stdout of this command is passed back to the client as http body. Http return code is than set to 200.</p>
<p><strong>Note: All hooks script should have executable flag set.</strong></p>
<div class="section" id="hooks-examples">
<h2>Hooks examples</h2>
<p>Some scripts files as example are availables inside the <tt class="docutils literal">hooks/</tt> directory.</p>
</div>
</div>
<div class="section" id="license">
<h1>LICENSE</h1>
<p>This project is released under MIT license.</p>
</div>

